<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="프로세카 계산기">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="apple-touch-startup-image" href="startup.png">
    <link rel="icon" type="image/png" href="icon2.png">
    <title>프로세카 계산기</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f2f5;
        }
        .container {
            background: #fff;
            padding: 2px 1px;
            border-radius: 15px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        label {
            display: inline;
            margin: 15px 0 5px;
            font-weight: bold;
            color: #555;
        }
        input, select {
            width: 25%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            text-align: center;
        }
        h2 {
            margin-top: 30px;
            color: #333;
        }
        p {
            font-size: 18px;
            color: #555;
            word-break: break-word;
        }
        #error-message {
            color: red;
            margin-top: 10px;
        }
        .tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        .tab {
            cursor: pointer;
            padding: 10px 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
			font-size: 15px;
			font-weight: bold;
        }
        .tab.active {
            background-color: #007bff;
            color: #fff;
        }
		.button-container {
			display: flex;
			justify-content: center;
			margin-top: 20px;
			flex-wrap: wrap;
		}
		.label {
			white-space: nowrap;
		}
        .action-button {
            background-color: #007BFF;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 10px;
			font-size: 14px;
			font-weight: bold;
        }
        .action-button:hover {
            background-color: #0056b3;
        }	
    </style>
</head>
<body>
    <div class="container">
        <h1>프로세카 계산기</h1>
        <div class="tabs">
            <div class="tab active" id="internal-tab" onclick="showTab('internal')">내부치</div>
            <div class="tab" id="kizuna-tab" onclick="showTab('kizuna')">키즈나</div>
            <div class="tab" id="card-tab" onclick="showTab('card')">카드레벨</div>
            <div class="tab" id="power-tab" onclick="showTab('power')">종합력 효율</div>
            <div class="tab" id="fire-tab" onclick="showTab('fire')">필요 불</div>
        </div>
        <div id="internal-tab-content">
            <label for="leader">리더 스킬:</label>
            <input type="number" id="leader" min="0" oninput="calculateInternal()">
			<span id="leader-unit">%</span><br>

            <label for="member2">멤버2 스킬:</label>
            <input type="number" id="member2" min="0" oninput="calculateInternal()">
			<span id="member2-unit">%</span><br>

            <label for="member3">멤버3 스킬:</label>
            <input type="number" id="member3" min="0" oninput="calculateInternal()">
			<span id="member3-unit">%</span><br>

            <label for="member4">멤버4 스킬:</label>
            <input type="number" id="member4" min="0" oninput="calculateInternal()">
			<span id="member4-unit">%</span><br>

            <label for="member5">멤버5 스킬:</label>
            <input type="number" id="member5" min="0" oninput="calculateInternal()">
			<span id="member5-unit">%</span>
        </div>
        <div id="kizuna-level-tab" style="display: none;">
            <label for="kizuna-current-level">현재 랭크:</label>
            <input type="number" id="kizuna-current-level" min="1" max="75" oninput="calculate('kizuna')"><br>

            <label for="kizuna-current-exp">남은 경험치:</label>
            <input type="number" id="kizuna-current-exp" min="0" oninput="calculate('kizuna')"><br>

            <label for="kizuna-target-level">목표 랭크:</label>
            <input type="number" id="kizuna-target-level" min="2" max="75" oninput="calculate('kizuna')"><br>

            <label for="kizuna-rank">라이브 랭크:</label>
            <select id="kizuna-rank" onchange="calculate('kizuna')">
                <option value="150">S</option>
                <option value="130">A</option>
				<option value="110">B</option>
				<option value="100">C</option>
            </select><br>

            <label for="kizuna-fires">라이브보너스:</label>
            <select id="kizuna-fires" onchange="calculate('kizuna')">
				<option value="1">0</option>
				<option value="5">1</option>
				<option value="10">2</option>
				<option value="14">3</option>
				<option value="17">4</option>
				<option value="20">5</option>
				<option value="21">6</option>
				<option value="22">7</option>
				<option value="23">8</option>
				<option value="24">9</option>
				<option value="25">10</option>
            </select>
        </div>
        <div id="card-level-tab" style="display: none;">
            <label for="current-level">현재 레벨:</label>
            <input type="number" id="current-level" min="1" max="60" oninput="calculate('card')"><br>

            <label for="current-exp">남은 경험치:</label>
            <input type="number" id="current-exp" min="0" oninput="calculate('card')"><br>

            <label for="target-level">목표 레벨:</label>
            <input type="number" id="target-level" min="2" max="60" oninput="calculate('card')"><br>

            <label for="rank">라이브 랭크:</label>
            <select id="rank" onchange="calculate('card')">
                <option value="960">S</option>
                <option value="840">A</option>
                <option value="720">B</option>
                <option value="600">C</option>
            </select><br>

            <label for="fires">라이브보너스:</label>
            <select id="fires" onchange="calculate('card')">
				<option value="1">0</option>
				<option value="5">1</option>
				<option value="10">2</option>
				<option value="14">3</option>
				<option value="17">4</option>
				<option value="20">5</option>
				<option value="21">6</option>
				<option value="22">7</option>
				<option value="23">8</option>
				<option value="24">9</option>
				<option value="25">10</option>
            </select>
        </div>
		<div id="power-tab-content">
			<label for="power">종합력:</label>
			<input type="number" id="power" min="0" max="40" oninput="calculatepower()">
			<span id="power-unit">만</span><br>

			<label for="effi">배수:</label>
			<input type="number" id="effi" min="0" max="1000" oninput="calculatepower()">
			<span id="effi-unit">%</span>
		</div>
		<div id="fire-tab-content">
			<label for="score1">현재점수:</label>
			<input type="number" id="score1" min="0" max="50000" oninput="calculatefire()">
			<span id="score1-unit">만</span><br>
			
			<label for="score2">목표점수:</label>
			<input type="number" id="score2" min="0" max="50000" oninput="calculatefire()">
			<span id="score2-unit">만</span><br>
			
			<label for="score3">판 당 점수:</label>
			<input type="number" id="score3" min="0" max="50000" oninput="calculatefire()">
			<span id="score3-unit">만</span><br>
			
			<label for="rounds1">간 당 판수:</label>
			<input type="number" id="rounds1" min="0" max="50000" oninput="calculatefire()">
			<span id="rounds1-unit">회</span><br>
			
            <label for="firea">현재 라이브보너스:</label>
            <select id="firea" onchange="calculatefire()">
				<option value="1">0</option>
				<option value="5">1</option>
				<option value="10">2</option>
				<option value="15">3</option>
				<option value="19">4</option>
				<option value="23">5</option>
				<option value="26">6</option>
				<option value="29">7</option>
				<option value="31">8</option>
				<option value="33">9</option>
				<option value="35">10</option>
            </select><br>
            <label for="fires2">라이브보너스 변경:</label>
            <select id="fires2" onchange="calculatefire()">
				<option value="none">변경없음</option>
				<option value="1">0</option>
				<option value="5">1</option>
				<option value="10">2</option>
				<option value="15">3</option>
				<option value="19">4</option>
				<option value="23">5</option>
				<option value="26">6</option>
				<option value="29">7</option>
				<option value="31">8</option>
				<option value="33">9</option>
				<option value="35">10</option>
            </select>
		</div>
        <h2></h2>
        <p id="needed-exp">필요 경험치: </p>
        <p id="needed-rounds">필요 판수: </p>
        <p id="exp-per-round">판 당 경험치 획득량: </p>
        <p id="internal-effective">실효치: </p>
        <p id="internal-sum">내부합: </p>
        <p id="multi-eff">멀티효율: </p>
        <p id="solo-eff">솔로효율: </p>
        <p id="auto-eff">오토효율: </p>
        <p id="neededRounds">필요 판수: </p>
        <p id="neededFires">필요 불: </p>
        <p id="neededTime">필요 시간: </p>
        <p id="error-message">에러: </p>
        <p id="internal-calculation-text"></p>
        <p id="power-calculation-text"></p>
        <p id="fire-calculation-text"></p>
    <div class="button-container">
        <button class="action-button" onclick="saveData()">저장</button>
        <button class="action-button" onclick="loadData()">불러오기</button>
    </div>
    <div class="button-container">
        <label class="label">
            <input type="checkbox" id="auto-load-checkbox" onchange="toggleAutoLoad()"> 자동 불러오기
        </label>
    </div>
    <script>
		let currentTab = 'internal';
        const expData = [
            {LV: 1, 필요EXP: 0, 누적EXP: 0},
            {LV: 2, 필요EXP: 3000, 누적EXP: 3000},
            {LV: 3, 필요EXP: 4000, 누적EXP: 7000},
            {LV: 4, 필요EXP: 5000, 누적EXP: 12000},
            {LV: 5, 필요EXP: 5400, 누적EXP: 17400},
            {LV: 6, 필요EXP: 5800, 누적EXP: 23200},
            {LV: 7, 필요EXP: 6200, 누적EXP: 29400},
            {LV: 8, 필요EXP: 6600, 누적EXP: 36000},
            {LV: 9, 필요EXP: 7000, 누적EXP: 43000},
            {LV: 10, 필요EXP: 7400, 누적EXP: 50400},
            {LV: 11, 필요EXP: 7800, 누적EXP: 58200},
            {LV: 12, 필요EXP: 8200, 누적EXP: 66400},
            {LV: 13, 필요EXP: 8600, 누적EXP: 75000},
            {LV: 14, 필요EXP: 9000, 누적EXP: 84000},
            {LV: 15, 필요EXP: 9400, 누적EXP: 93400},
            {LV: 16, 필요EXP: 9800, 누적EXP: 103200},
            {LV: 17, 필요EXP: 10200, 누적EXP: 113400},
            {LV: 18, 필요EXP: 10600, 누적EXP: 124000},
            {LV: 19, 필요EXP: 11000, 누적EXP: 135000},
            {LV: 20, 필요EXP: 11400, 누적EXP: 146400},
            {LV: 21, 필요EXP: 11800, 누적EXP: 158200},
            {LV: 22, 필요EXP: 12200, 누적EXP: 170400},
            {LV: 23, 필요EXP: 12600, 누적EXP: 183000},
            {LV: 24, 필요EXP: 13000, 누적EXP: 196000},
            {LV: 25, 필요EXP: 13400, 누적EXP: 209400},
            {LV: 26, 필요EXP: 13800, 누적EXP: 223200},
            {LV: 27, 필요EXP: 14200, 누적EXP: 237400},
            {LV: 28, 필요EXP: 14600, 누적EXP: 252000},
            {LV: 29, 필요EXP: 15000, 누적EXP: 267000},
            {LV: 30, 필요EXP: 15400, 누적EXP: 282400},
            {LV: 31, 필요EXP: 15800, 누적EXP: 298200},
            {LV: 32, 필요EXP: 16200, 누적EXP: 314400},
            {LV: 33, 필요EXP: 16600, 누적EXP: 331000},
            {LV: 34, 필요EXP: 17000, 누적EXP: 348000},
            {LV: 35, 필요EXP: 17400, 누적EXP: 365400},
            {LV: 36, 필요EXP: 17800, 누적EXP: 383200},
            {LV: 37, 필요EXP: 18200, 누적EXP: 401400},
            {LV: 38, 필요EXP: 18600, 누적EXP: 420000},
            {LV: 39, 필요EXP: 19000, 누적EXP: 439000},
            {LV: 40, 필요EXP: 19400, 누적EXP: 458400},
            {LV: 41, 필요EXP: 19800, 누적EXP: 478200},
            {LV: 42, 필요EXP: 20200, 누적EXP: 498400},
            {LV: 43, 필요EXP: 20600, 누적EXP: 519000},
            {LV: 44, 필요EXP: 21000, 누적EXP: 540000},
            {LV: 45, 필요EXP: 21400, 누적EXP: 561400},
            {LV: 46, 필요EXP: 21800, 누적EXP: 583200},
            {LV: 47, 필요EXP: 22200, 누적EXP: 605400},
            {LV: 48, 필요EXP: 22600, 누적EXP: 628000},
            {LV: 49, 필요EXP: 23000, 누적EXP: 651000},
            {LV: 50, 필요EXP: 23400, 누적EXP: 674400},
            {LV: 51, 필요EXP: 23800, 누적EXP: 698200},
            {LV: 52, 필요EXP: 24200, 누적EXP: 722400},
            {LV: 53, 필요EXP: 24600, 누적EXP: 747000},
            {LV: 54, 필요EXP: 25000, 누적EXP: 772000},
            {LV: 55, 필요EXP: 25400, 누적EXP: 797400},
            {LV: 56, 필요EXP: 25800, 누적EXP: 823200},
            {LV: 57, 필요EXP: 26200, 누적EXP: 849400},
            {LV: 58, 필요EXP: 26600, 누적EXP: 876000},
            {LV: 59, 필요EXP: 27000, 누적EXP: 903000},
            {LV: 60, 필요EXP: 27400, 누적EXP: 930400}
        ];

        const kizunaData = [
			{LV: 1, 필요EXP: 0, 누적EXP: 0},
			{LV: 2, 필요EXP: 7224, 누적EXP: 7224},
			{LV: 3, 필요EXP: 7224, 누적EXP: 14448},
			{LV: 4, 필요EXP: 7224, 누적EXP: 21672},
			{LV: 5, 필요EXP: 7224, 누적EXP: 28896},
			{LV: 6, 필요EXP: 7224, 누적EXP: 36120},
			{LV: 7, 필요EXP: 28094, 누적EXP: 64214},
			{LV: 8, 필요EXP: 28094, 누적EXP: 92308},
			{LV: 9, 필요EXP: 28094, 누적EXP: 120402},
			{LV: 10, 필요EXP: 60200, 누적EXP: 180602},
			{LV: 11, 필요EXP: 60200, 누적EXP: 240802},
			{LV: 12, 필요EXP: 60200, 누적EXP: 301002},
			{LV: 13, 필요EXP: 70234, 누적EXP: 371236},
			{LV: 14, 필요EXP: 70234, 누적EXP: 441470},
			{LV: 15, 필요EXP: 70234, 누적EXP: 511704},
			{LV: 16, 필요EXP: 100332, 누적EXP: 612036},
			{LV: 17, 필요EXP: 100332, 누적EXP: 712368},
			{LV: 18, 필요EXP: 100332, 누적EXP: 812700},
			{LV: 19, 필요EXP: 130432, 누적EXP: 943132},
			{LV: 20, 필요EXP: 130432, 누적EXP: 1073564},
			{LV: 21, 필요EXP: 130432, 누적EXP: 1203996},
			{LV: 22, 필요EXP: 160534, 누적EXP: 1364530},
			{LV: 23, 필요EXP: 160534, 누적EXP: 1525064},
			{LV: 24, 필요EXP: 160534, 누적EXP: 1685598},
			{LV: 25, 필요EXP: 210700, 누적EXP: 1896298},
			{LV: 26, 필요EXP: 210700, 누적EXP: 2106998},
			{LV: 27, 필요EXP: 210700, 누적EXP: 2317698},
			{LV: 28, 필요EXP: 250834, 누적EXP: 2568532},
			{LV: 29, 필요EXP: 250834, 누적EXP: 2819366},
			{LV: 30, 필요EXP: 250834, 누적EXP: 3070200},
			{LV: 31, 필요EXP: 280934, 누적EXP: 3351134},
			{LV: 32, 필요EXP: 280934, 누적EXP: 3632068},
			{LV: 33, 필요EXP: 280934, 누적EXP: 3913002},
			{LV: 34, 필요EXP: 301000, 누적EXP: 4214002},
			{LV: 35, 필요EXP: 301000, 누적EXP: 4515002},
			{LV: 36, 필요EXP: 301000, 누적EXP: 4816002},
			{LV: 37, 필요EXP: 301000, 누적EXP: 5117002},
			{LV: 38, 필요EXP: 301000, 누적EXP: 5418002},
			{LV: 39, 필요EXP: 301000, 누적EXP: 5719002},
			{LV: 40, 필요EXP: 301000, 누적EXP: 6020002},
			{LV: 41, 필요EXP: 301000, 누적EXP: 6321002},
			{LV: 42, 필요EXP: 301000, 누적EXP: 6622002},
			{LV: 43, 필요EXP: 301000, 누적EXP: 6923002},
			{LV: 44, 필요EXP: 301000, 누적EXP: 7224002},
			{LV: 45, 필요EXP: 301000, 누적EXP: 7525002},
			{LV: 46, 필요EXP: 301000, 누적EXP: 7826002},
			{LV: 47, 필요EXP: 301000, 누적EXP: 8127002},
			{LV: 48, 필요EXP: 301000, 누적EXP: 8428002},
			{LV: 49, 필요EXP: 301000, 누적EXP: 8729002},
			{LV: 50, 필요EXP: 301000, 누적EXP: 9030002},
			{LV: 51, 필요EXP: 301000, 누적EXP: 9331002},
			{LV: 52, 필요EXP: 301000, 누적EXP: 9632002},
			{LV: 53, 필요EXP: 301000, 누적EXP: 9933002},
			{LV: 54, 필요EXP: 301000, 누적EXP: 10234002},
			{LV: 55, 필요EXP: 301000, 누적EXP: 10535002},
			{LV: 56, 필요EXP: 301000, 누적EXP: 10836002},
			{LV: 57, 필요EXP: 301000, 누적EXP: 11137002},
			{LV: 58, 필요EXP: 301000, 누적EXP: 11438002},
			{LV: 59, 필요EXP: 301000, 누적EXP: 11739002},
			{LV: 60, 필요EXP: 301000, 누적EXP: 12040002},
			{LV: 61, 필요EXP: 301000, 누적EXP: 12341002},
			{LV: 62, 필요EXP: 301000, 누적EXP: 12642002},
			{LV: 63, 필요EXP: 301000, 누적EXP: 12943002},
			{LV: 64, 필요EXP: 301000, 누적EXP: 13244002},
			{LV: 65, 필요EXP: 301000, 누적EXP: 13545002},
			{LV: 66, 필요EXP: 301000, 누적EXP: 13846002},
			{LV: 67, 필요EXP: 301000, 누적EXP: 14147002},
			{LV: 68, 필요EXP: 301000, 누적EXP: 14448002},
			{LV: 69, 필요EXP: 301000, 누적EXP: 14749002},
			{LV: 70, 필요EXP: 301000, 누적EXP: 15050002},
			{LV: 71, 필요EXP: 301000, 누적EXP: 15351002},
			{LV: 72, 필요EXP: 301000, 누적EXP: 15652002},
			{LV: 73, 필요EXP: 301000, 누적EXP: 15953002},
			{LV: 74, 필요EXP: 301000, 누적EXP: 16254002},
			{LV: 75, 필요EXP: 301000, 누적EXP: 16555002}
        ];
        function showTab(tab) {
            document.getElementById('internal-tab-content').style.display = 'none';
            document.getElementById('kizuna-level-tab').style.display = 'none';
            document.getElementById('card-level-tab').style.display = 'none';
            document.getElementById('power-tab-content').style.display = 'none';
            document.getElementById('fire-tab-content').style.display = 'none';
            document.getElementById('internal-tab').classList.remove('active');
            document.getElementById('kizuna-tab').classList.remove('active');
            document.getElementById('card-tab').classList.remove('active');
            document.getElementById('power-tab').classList.remove('active');
            document.getElementById('fire-tab').classList.remove('active');

            if (tab === 'internal') {
				clearResults();
                document.getElementById('internal-tab-content').style.display = 'block';
                document.getElementById('internal-tab').classList.add('active');
				setTab('internal');
            } else if (tab === 'kizuna') {
				clearResults();
                document.getElementById('kizuna-level-tab').style.display = 'block';
                document.getElementById('kizuna-tab').classList.add('active');
				setTab('kizuna');
            } else if (tab === 'card') {
				clearResults();
                document.getElementById('card-level-tab').style.display = 'block';
                document.getElementById('card-tab').classList.add('active');
				setTab('card');
            } else if (tab === 'power') {
				clearResults();
                document.getElementById('power-tab-content').style.display = 'block';
                document.getElementById('power-tab').classList.add('active');
				setTab('power');
            } else {
				clearResults();
                document.getElementById('fire-tab-content').style.display = 'block';
                document.getElementById('fire-tab').classList.add('active');
				setTab('fire');
            }
            calculate(tab);
        }
        function toggleAutoLoad() {
            let autoLoadCheckbox = document.getElementById('auto-load-checkbox');
            localStorage.setItem('autoLoad', autoLoadCheckbox.checked);
        }

        window.onload = function() {
            let autoLoad = JSON.parse(localStorage.getItem('autoLoad'));
            let autoLoadCheckbox = document.getElementById('auto-load-checkbox');
            if (autoLoad) {
                autoLoadCheckbox.checked = true;
                loadData();
            } else {
                autoLoadCheckbox.checked = false;
            }
        }
		function getFireaValue(firea) {
			const fireaTable = {
				1: 0,
				5: 1,
				10: 2,
				15: 3,
				19: 4,
				23: 5,
				26: 6,
				29: 7,
				31: 8,
				33: 9,
				35: 10
			};
			return fireaTable[firea] || null; // returns null if firea is not in the table
		}
		function calculate(type) {
			// Clear previous error message
			document.getElementById("error-message").innerText = '';

			let currentLevel, currentExpToLevelUp, targetLevel, rankExp, fires;

			if (type === 'card') {
				currentLevel = parseInt(document.getElementById("current-level").value);
				currentExpToLevelUp = parseInt(document.getElementById("current-exp").value);
				targetLevel = parseInt(document.getElementById("target-level").value);
				rankExp = parseInt(document.getElementById("rank").value);
				fires = parseInt(document.getElementById("fires").value);

				if (isNaN(currentLevel) || isNaN(currentExpToLevelUp) || isNaN(targetLevel) || isNaN(rankExp) || isNaN(fires)) {
					document.getElementById("error-message").innerText = '에러: 모든 입력 값을 정확히 입력해 주세요.';
					clearResults();
					return;
				}

				if (currentLevel >= targetLevel) {
					document.getElementById("error-message").innerText = '에러: 목표 레벨은 현재 레벨보다 높아야 합니다.';
					clearResults();
					return;
				}

				const data = expData;
				const currentData = data.find(d => d.LV === currentLevel);
				const nextLevelData = data.find(d => d.LV === currentLevel + 1);
				const targetData = data.find(d => d.LV === targetLevel);

				if (!currentData || !nextLevelData || !targetData) {
					document.getElementById("error-message").innerText = '에러: 레벨 데이터를 불러오는 데 실패했습니다.';
					clearResults();
					return;
				}

				const currentCumulativeExp = currentData.누적EXP + nextLevelData.필요EXP - currentExpToLevelUp;
				const targetCumulativeExp = targetData.누적EXP;

				const neededExp = targetCumulativeExp - currentCumulativeExp;
				const expPerRound = rankExp * fires;
				const neededRounds = Math.ceil(neededExp / expPerRound);

				document.getElementById("needed-exp").innerHTML = `필요 경험치: <span style="font-weight: bold; color: blue;">${neededExp}</span>`;
				document.getElementById("needed-rounds").innerHTML = `필요 판수: <span style="font-weight: bold; color: blue;">${neededRounds}</span>`;
				document.getElementById("exp-per-round").innerHTML = `판 당 경험치 획득량: <span style="font-weight: bold; color: blue;">${expPerRound}</span>`;
			} else if (type === 'kizuna') {
				currentLevel = parseInt(document.getElementById("kizuna-current-level").value);
				currentExpToLevelUp = parseInt(document.getElementById("kizuna-current-exp").value);
				targetLevel = parseInt(document.getElementById("kizuna-target-level").value);
				rankExp = parseInt(document.getElementById("kizuna-rank").value);
				fires = parseInt(document.getElementById("kizuna-fires").value);

				if (isNaN(currentLevel) || isNaN(currentExpToLevelUp) || isNaN(targetLevel) || isNaN(rankExp) || isNaN(fires)) {
					document.getElementById("error-message").innerText = '에러: 모든 입력 값을 정확히 입력해 주세요.';
					clearResults();
					return;
				}

				if (currentLevel >= targetLevel) {
					document.getElementById("error-message").innerText = '에러: 목표 랭크는 현재 랭크보다 높아야 합니다.';
					clearResults();
					return;
				}

				const data = kizunaData;
				const currentData = data.find(d => d.LV === currentLevel);
				const nextLevelData = data.find(d => d.LV === currentLevel + 1);
				const targetData = data.find(d => d.LV === targetLevel);

				if (!currentData || !nextLevelData || !targetData) {
					document.getElementById("error-message").innerText = '에러: 랭크 데이터를 불러오는 데 실패했습니다.';
					clearResults();
					return;
				}

				const currentCumulativeExp = currentData.누적EXP + nextLevelData.필요EXP - currentExpToLevelUp;
				const targetCumulativeExp = targetData.누적EXP;

				const neededExp = targetCumulativeExp - currentCumulativeExp;
				const expPerRound = rankExp * fires;
				const neededRounds = Math.ceil(neededExp / expPerRound);

				document.getElementById("needed-exp").innerHTML = `필요 경험치: <span style="font-weight: bold; color: blue;">${neededExp}</span>`;
				document.getElementById("needed-rounds").innerHTML = `필요 판수: <span style="font-weight: bold; color: blue;">${neededRounds}</span>`;
				document.getElementById("exp-per-round").innerHTML = `판 당 경험치 획득량: <span style="font-weight: bold; color: blue;">${expPerRound}</span>`;
			} else if (type === 'internal') {
				calculateInternal();
			} else if (type === 'power') {
				calculatepower();
			} else {
				calculatefire();
			}
		}

		function calculateInternal() {
			const leader = parseInt(document.getElementById("leader").value) || 0;
			const member2 = parseInt(document.getElementById("member2").value) || 0;
			const member3 = parseInt(document.getElementById("member3").value) || 0;
			const member4 = parseInt(document.getElementById("member4").value) || 0;
			const member5 = parseInt(document.getElementById("member5").value) || 0;

			const internalSum = leader + member2 + member3 + member4 + member5;
			const effectiveValue = leader + (member2 + member3 + member4 + member5) * 0.2;
			const effectiveMultiplier = (effectiveValue / 100) + 1;

			document.getElementById("internal-effective").innerHTML = `실효치: <span style="font-weight: bold; color: blue;">${effectiveValue.toFixed(0)}%</span> = <span style="font-weight: bold; color: blue;">${effectiveMultiplier.toFixed(2)}배</span>`;
			document.getElementById("internal-sum").innerHTML = `내부합: <span style="font-weight: bold; color: blue;">${internalSum}</span>`;
			document.getElementById("internal-calculation-text").innerText = "실효치 = 리더 + (나머지멤버) * 0.2";
		}
		
		function calculatepower() {
			const power = parseInt(document.getElementById("power").value) || 0;
			const effi = parseInt(document.getElementById("effi").value) || 0;

            const multiConstant = 4.877;
            const soloConstant = 2.8;
            const autoConstant = 1.84;
			
            const multiEfficiency = (((100 + ((power + 1) * multiConstant)) / (100 + (power * multiConstant))) - 1) * (100 + effi);
            const soloEfficiency = (((100 + ((power + 1) * soloConstant)) / (100 + (power * soloConstant))) - 1) * (100 + effi);
            const autoEfficiency = (((100 + ((power + 1) * autoConstant)) / (100 + (power * autoConstant))) - 1) * (100 + effi);
			document.getElementById("multi-eff").innerHTML = `멀티효율: <span style="font-weight: bold; color: blue;">${multiEfficiency.toFixed(2)}%</span>`;
			document.getElementById("solo-eff").innerHTML = `솔로효율: <span style="font-weight: bold; color: blue;">${soloEfficiency.toFixed(2)}%</span>`;
			document.getElementById("auto-eff").innerHTML = `오토효율: <span style="font-weight: bold; color: blue;">${autoEfficiency.toFixed(2)}%</span>`;
			document.getElementById("power-calculation-text").innerHTML = "종합력 1만과 같은 효율의 배수<br><br>대략적인 값으로 곡이나 스킬에 따라 달라짐";
		}
		
        function calculatefire() {
            // Get input values
            let currentScore = parseFloat(document.getElementById('score1').value) || 0;
            let targetScore = parseFloat(document.getElementById('score2').value) || 0;
            let scorePerRound = parseFloat(document.getElementById('score3').value) || 0;
            let roundsPerInterval = parseFloat(document.getElementById('rounds1').value) || 0;
            let currentFireBonus = parseInt(document.getElementById('firea').value) || 0;
            let changeFireBonus = document.getElementById('fires2').value;
			let firenow = getFireaValue(currentFireBonus);


            // Determine calculation score
            let calculationScore;
            if (changeFireBonus === "none") {
                calculationScore = scorePerRound;
            } else {
                let newFireBonus = parseInt(changeFireBonus);
                calculationScore = (scorePerRound / currentFireBonus) * newFireBonus;
                currentFireBonus = newFireBonus;
				firenow = getFireaValue(currentFireBonus);
            }

            // Calculate needed rounds
            let neededRounds = (targetScore - currentScore) / calculationScore;
            neededRounds = neededRounds > 0 ? neededRounds : 0; // Prevent negative rounds
			neededRounds = Math.ceil(neededRounds)

            // Calculate needed fires
            let neededFires = neededRounds * firenow;

            // Calculate needed time
            let neededTime = neededRounds / roundsPerInterval;
            neededTime = neededTime > 0 ? neededTime : 0; // Prevent negative time

            // Display results
            document.getElementById('neededRounds').innerHTML = `필요 판수: <span style="font-weight: bold; color: blue;">${Math.ceil(neededRounds)}</span> 판`;
            document.getElementById('neededFires').innerHTML = `필요불: <span style="font-weight: bold; color: blue;">${Math.ceil(neededFires)}</span> 불`;
            document.getElementById('neededTime').innerHTML = `필요시간: <span style="font-weight: bold; color: blue;">${neededTime.toFixed(1)}</span> 시간`;
			document.getElementById("fire-calculation-text").innerHTML = '<span style="font-weight: bold">대략적인 간 당 판수</span><br>엔비:26~29  로앤파:16~18  치어풀:15~17';
        }

		function clearResults() {
			document.getElementById("needed-exp").innerText = '';
			document.getElementById("needed-rounds").innerText = '';
			document.getElementById("exp-per-round").innerText = '';
			document.getElementById("internal-effective").innerText = '';
			document.getElementById("internal-sum").innerText = '';
			document.getElementById("internal-calculation-text").innerText = '';
			document.getElementById("multi-eff").innerText = '';
			document.getElementById("solo-eff").innerText = '';
			document.getElementById("auto-eff").innerText = '';
			document.getElementById("power-calculation-text").innerText = '';
			document.getElementById("neededRounds").innerText = '';
			document.getElementById("neededFires").innerText = '';
			document.getElementById("neededTime").innerText = '';
			document.getElementById("fire-calculation-text").innerText = '';
		}
		function setTab(tab) {
			currentTab = tab;
		}
		document.addEventListener('DOMContentLoaded', () => {
			showTab('internal');
		});
		function saveData() {
			let surveyData = {};
			document.querySelectorAll('#leader, #member2, #member3, #member3, #member4, #member5, #kizuna-current-level, #kizuna-current-exp, #kizuna-target-level, #kizuna-rank, #kizuna-fires, #current-level, #current-exp, #target-level, #rank, #fires, #power, #effiscore1, #score1, #score2, #score3, #rounds1, #firea, #fires2').forEach(input => {
				surveyData[input.id] = input.value;
			});
			localStorage.setItem('surveyData', JSON.stringify(surveyData));
			alert('데이터가 저장되었습니다.');
		}

		function loadData() {
			let surveyData = JSON.parse(localStorage.getItem('surveyData'));
			if (surveyData) {
				Object.keys(surveyData).forEach(key => {
					let input = document.getElementById(key);
					if (input) {
						input.value = surveyData[key];
					}
				});
			switch (currentTab) {
				case 'internal':
					calculateInternal();
					break;
				case 'kizuna':
					calculate('kizuna');
					break;
				case 'card':
					calculate('card');
					break;
				case 'power':
					calculatepower();
					break;
				case 'fire':
					calculatefire();
					break;
				default:
					calculateInternal();
					break;
			}
			} else {
				alert('저장된 데이터가 없습니다.');
			}
		}
    </script>
</body>
</html>
